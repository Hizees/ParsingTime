\Section{repr}{Representation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TEMPORAL EXPRESSIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Subsection{repr-types}{Temporal Expression Types}
% -- Intro to Types
We define the representation of temporal entities to be used in parsing.
Each word would be generated by an entity in one of the following categories:
% -- Range
\paragraph{Range}
%(definition)
A period between two dates (or date$+$times).
%(examples)
This includes entities such as \te{Today}, \te{1987}, or
	\te{Now}.
We denote a range by the variable \range.

%(point vs. interval based)
The third of these is worth a particular mention:
	unlike the previous examples, the start and end of the range are the same.
That is, \te{Today} spans a day, \te{1987} spans a year; \te{Now}
	spans no time.
A point-based representation of time -- such as those described in
	certain works \needcite -- would dictate this as a distinct type.
To simplify our grammar and representation, we adopt an interval-based
	representation \needcite.

% -- Sequence 
\paragraph{Sequence}
%(definition)
A sequence of \ty{Range}s.
%(examples)
This includes entities such as \te{Friday}, \te{November \th{27}}, or
	\te{last May}.
%(anatomy)
A given sequence is in reality a tuple of three elements
	$\seq=(\seqelem,\seqjump,\seqcanon)$:
\begin{enumerate}
	\item $\seqelem(i)$: 
		The \th{i} element of a sequence.
		This is a \ty{Range} by type, and is the type returned when a sequence is
			asked to ground.A
		In the case of the sequence \te{Friday}, $\seqelem(0)$ corresponds to
			\tp{the Friday in the current week}; 
			$\seqelem(1)$ is the Friday in the following week, \textit{et cetera}.
	\item \seqjump:
		The \textit{distance} between two elements in the sequence.
		In the case of \te{Friday}, this distance would be a \te{Week}.
	\item \seqcanon:
		The \textit{containing unit} of an element of a sequence.
		For example, \seqcanonX{Friday} would be the \ty{Range}
			corresponding to \tp{the current week}.
		In the case of \tp{November}, or even \tp{November \th{27}}. this 
			would correspond to the current year.
\end{enumerate}

%(definition of relative index)
The index $i \in \BZ$ is defined relative to the zero index of the sequence,
	which is defined as the element of the sequence
	that is within the containing unit \seqcanon\ of the sequence in which the 
	reference time also lies.
This is consistent with our definition of \seqelem.

%(sequence as distribution)
This type warrants special attention, as the pragmatic ambiguity when
	describing temporal expressions resides in the interpretation of these
	terms.
Therefore, a \ty{Sequence} denotes not only a sequence of possible
	\ty{Range}s, but also a distribution over these ranges.
We define this distribution -- conditioned on a reference time $t$ --
	as a Gaussian with a mean and variance defined according
	to the distance \seqjump\ between two elements in a given sequence $s$.
The input to the Gaussian is the index $i$ of the element in the sequence;
	and, the distance between the reference time and the beginning
	of the element in question $\delta_{s,t}(i)$:
\begin{equation}
\label{eqn:gaussian}
	P_t(i) = 
	\int_{i-0.5}^{i+0.5}
		\frac{1}{2\pi\sigma^2} 
			\exp\left[-\frac{
					(\frac{\delta_{s,t}(i)}{\seqjump} - \mu)^2
				}{
					2\sigma^2
				}
			\right]
\end{equation}
\needfig shows an example of such a distribution.

%(global scope)
The parameters $\mu$ and $\sigma$ in Equation \refeqn{gaussian} are shared
	among all particular sequence instances; the normalization
	with respect to \seqjump\ ensures that the distribution is applicable
	to any particular sequence.
For example, the distance between a Wednesday to that week's \te{Friday}
	would be $2/7$, counted with respect to a week; 
	the distance from April to that year's \te{November} would be a 
	comparable $7/12$ (approximately), counted with respect to a month.
	
% -- Duration
\paragraph{Duration}
%(definition)
A period of time -- effectively a number of milliseconds.
%(examples)
This includes entities like \te{Week}, \te{Month}, and \te{7 days}.
%(etc)
We denote a duration with the variable \dur.

%(fuzzy)
We define a special case of the \ty{Duration} type to represent 
	\textit{approximate} durations.
These are used to represent expressions such as \tp{a few years} or
	\tp{some days}.
Semantically, these are represented by a single unit of duration with the
	quantity omitted, and are taken to be equivalent to any other approximate
	duration with the same unit and distinct from any other \ty{Duration}.
This is consistent with the representation of such entities in the
	\texttt{Timex} format \needcite.

% -- Functions
\paragraph{Function}
%(definition)
A function of arity less than or equal to two representing some
	general modification to one of the above types.
%(examples)
This includes the functions corresponding to phrases such as
	\tp{last $x$}, \tp{the third $x$ [of $y$]}, or \tp{$x$ days ago}.
%(etc)
The particular functions and their application are discussed later.


% -- Other
\paragraph{Other Types}
In addition to the types described above, there are two other types which
	have relevance in the parsing as described in \refsec{learn}.
Both of these types are applicable as preterminals only.

The first of these types is \ty{Number} -- denoting a number without
	any semantic meaning attached yet.
This comes into play with expressions such as \tp{2 weeks}, in which
	the number $2$ has no temporal meaning on its own.

The other type are the \ty{Nil} types -- denoting terms which are not
	directly contributing to the semantic meaning of the expression.
These are intended for words such as \tp{a} or \tp{the}, which serve as cues
	informing the resulting temporal expression without being meaningful
	in themselves.
The \ty{Nil} type is lexicalized with the word it generates; more details
	are given in \refsecs{repr-lexicon}{repr-rules}.
Naturally, our representation is incomplete in capturing all possible
	temporal phenomena; a subset of these omissions are given below.


\paragraph{Omitted Phenomena}
The temporal representation described above is a simplification of the
	possible phenomena that occur in time.
Among these, \todo{describe and cite stuff here -- e.g. disjoint intervals}.

Practically, our representation is unable to represent approximate ranges;
	for example, \tp{a year in the 90's} or \tp{some evening}.
These are valid in the \texttt{Timex} specification; therefore, the decision
	to omit these for simplicity comes at the expense of a small performance hit.

We proceed to describe the grammar used to manipulate the types and specific
	instances of these types.
\refsec{repr-lexicon} describes the instances of the types described
	above; \refsec{repr-rules} describes the grammar rules of the types,
	and their correpsonding semantic impact on the instances.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TIME AS COMPOSITIONAL PARSING
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Subsection{repr-compositional}{Time As Compositional Parsing}
\todo{Compositional semantics citations}
% -- Time is compositional
We make the simplifying assumption that the natural language description
	of time is compositional in nature.
Unlike many aspects of language  -- which are either not compositional or
	riddled with idioms -- as a temporal phrase increases in length it is
	usually compositionally modifying the meaning of a shorter segment of itself.
To demonstrate and introduce a running example, we consider the expression
	\tp{last Friday the \th{13}}.
Decomposing the example, we can construct a meaning by taking \tp{Friday},
	and applying the modifiers \tp{last} -- taking the previous \te{Friday};
	and \tp{the \th{13}} -- taking the previous \te{Friday} that is
	also the \th{13} of the month.

% -- Focus on time; elsewhere applicable
While we focus entirely on temporal phrases and their meaning, this
	compositional assumption is reasonable for a number of other domains as 
	well -- for example describing locations or directions (e.g. the 
	\dataset{GeoQueries} dataset \needcite).

% -- Synchronous Grammar
%(introduction)
We construct a paradigm for parsing temporal phrases based on a Synchronous
	PCFG defined over the the temporal \textit{instances} and their
	corresponding \textit{types}; similar in some respects but more
	constrained than those used in machine translation \needcite.
\needfig shows an example of such a grammar.

%(formal definition)
Formally, we define a Synchonous PCFG 
	$G = \left(\Sigma,S,\sV,\sW,\sR,P\right)$.
The alphabet $\Sigma$ and start symbol $S$ remain unchanged from their
	usual interpretations.

%(nonterminals)
We define a set $\sV$ to be the set of types as described in
	\refsec{repr-types} -- these act as our nonterminals.
For each $v \in \sV$ we define an (infinite) set $W$ corresponding to the 
	possible instances of type $v$.
Concretely, if $v=\ty{Sequence}$, our set $W_v \in \sW$ could contain elements
	corresponding to \tp{Friday}, \tp{last Friday}, \tp{the Friday after next},
	\textit{et cetera}.
These serve as the nonterminals in the synchronous grammar.
The creation of these entries are described in detail in \refsec{repr-lexicon}.

%(rules)
A rule $R \in \sR$ is defined as a pair 
	$R = \left(v_i \rightarrow v_jv_k, 
		f : (W_{v_j},W_{v_k}) \rightarrow W_{v_i}\right)$
The first term is a conventional PCFG rule over the set of nonterminals
	$\sV$.
In a conventional synchronous PCFGs, the second term would be the corresponding
	combination rule over our nonterminals $\sW$.
In our case, this term is rather a deterministic function mapping the
	constituent expressions to the parent expression.
This both handles the unbounded domain of temporal expressions in $\sW$,
	as well as simplifies the formalism.
Note that the definition above is trivially adapted for the case of unary
	rules.
The application of these rules is described in more detail in 
	\refsec{repr-rules}.

%(probabilities)
The last term in our grammar formalism denotes the rule probabilities $P$.
In line with the usual interpretation, this defines a probability
	of a combination of nonterminals in $\sV$.
Importantly, note that the probabilities associated with the temporal
	expressions themselves are not included here, nor in the grammar
	formalism at all.
The learning of these probabilities is detailed in \refsec{learn}

%(motivation)
We defined a paradigm for expressing how natural language composes
	temporal phrases while accounting for the sparsity inherent in composing
	individal expressions -- as well as helping ensure that the resulting
	expressions are semantically valid.
In parallel, a particular temporal expression is parsed, which can then
	be grounded by a reference time to provide the final temporal expression.
We continue to describe the preterminals of our grammar and the introduction
	of our synchronous terms.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% LEXICON
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Subsection{repr-lexicon}{Preterminals}
% -- Static Lexicon
\begin{table}
	\begin{center}
	\begin{tabular}{|l|l|}
		\hline
		\textbf{Type} & \textbf{Instances} \\
		\hline
		\hline
		% -- Ranges
		\ty{Range} &
			\te{Past}, \te{Future}, \te{Yesterday}, \\
			& \te{Tomorrow}, \te{Today}, \te{Reference}, \\
			& \te{Year($n$)}, \te{Century($n$)} \\
		\hline
		% -- Sequences
		\ty{Sequence} 
			%(named sequences)
			& \te{Morning}, \te{Afternoon}, $\dots$ \\
			& \te{Monday}, \te{Tuesday}, $\dots$ \\
			& \te{January}, \te{February}, $\dots$ \\
			& \te{Winter}, \te{Spring}, $\dots$ \\
			%(from number)
			& \te{MinuteOfHour($0 \dots 59$)}, \\
			& \te{HourOfDay($0 \dots 23$)}, \\
			& \te{DayOfMonth($1 \dots 31$)}, \\
			& \te{MonthOfYear($1 \dots 12$)}, \\
			& \te{YearOfCentury($0 \dots 99$)}, \\
			& \te{DecadeOfCentury($0 \dots 9$)}, \\
			& \te{YearOfDecade($0 \dots 9$)}, \\
			%(durational)
			& \te{EveryDay}, \te{EveryWeek}, \\
			& \te{EveryMonth}, \te{EveryQuarter}, \\
			& \te{EverySeason} \\
		\hline
		% -- Durations
		\ty{Duration}
			& \te{Second}, \te{Minute}, \te{Hour}, \\
			& \te{Day}, \te{Week}, \te{Month}, \te{Quarter}, \\
			& \te{Year}, \te{Decade}, \te{Century} \\
		\hline
	\end{tabular}
	\caption{
		The content-bearing preterminals of the grammar, arranged by their
			types.
		Note that the elements on the right denote the semantic meaning of the
			element and have no relation to the phrase given;
			furthermore, lines ending with elipses denote more elements of the
			same time which have been omitted for brevity.
	}
	\label{tab:content}
	\end{center}
\end{table}

% -- Function Lexicon
\begin{table*}
	\begin{center}
	\begin{tabular}{|l|l|l|}
		\hline
		\textbf{Function} & \textbf{Description} & \textbf{Signature} \\
		\hline
		\hline
		% -- Arity 2
		%(shift left)
		\texttt{shiftLeft}
			& Shift a \ty{Range} or \ty{Sequence} left by a \ty{Duration}
			& $f : \ty{Sequence},\ty{Duration} \rightarrow \ty{Sequence}$ \\
			& & $f : \ty{Range},\ty{Duration} \rightarrow \ty{Range}$ \\
		\texttt{shiftRight}
			& Shift a \ty{Range} or \ty{Sequence} right by a \ty{Duration}
			& $f : \ty{Sequence},\ty{Duration} \rightarrow \ty{Sequence}$ \\
			& & $f : \ty{Range},\ty{Duration} \rightarrow \ty{Range}$ \\
		\hline
		%(shrink begin)
		\texttt{shrinkBegin}
			& Take the first \ty{Duration} of a \ty{Range}/\ty{Sequence}
			& $f : \ty{Sequence},\ty{Duration} \rightarrow \ty{Sequence}$ \\
			& & $f : \ty{Range},\ty{Duration} \rightarrow \ty{Range}$ \\
		\texttt{shrinkEnd}
			& Take the last \ty{Duration} of a \ty{Range}/\ty{Sequence}
			& $f : \ty{Sequence},\ty{Duration} \rightarrow \ty{Sequence}$ \\
			& & $f : \ty{Range},\ty{Duration} \rightarrow \ty{Range}$ \\
		\hline
		\texttt{catLeft}
			& Take \ty{Duration} units after the end of a \ty{Range}
			& $f : \ty{Range},\ty{Duration} \rightarrow \ty{Range}$ \\
		\texttt{catRight}
			& Take \ty{Duration} units before the start of a \ty{Range}
			& $f : \ty{Range},\ty{Duration} \rightarrow \ty{Range}$ \\
		\hline
		% -- Arity 1
		%(seq move)
		\texttt{moveLeft1}
			& Move the \textit{zero index} of a \ty{sequence} left by 1
			& $f : \ty{Sequence} \rightarrow \ty{Sequence}$ \\
		\texttt{moveRight1}
			& Move the \textit{zero index} of a sequence right by 1
			& $f : \ty{Sequence} \rightarrow \ty{Sequence}$ \\
		\hline
		%(n^th element)
		\texttt{\th{$n$} $x$ of $y$}
			& Take the \th{$n$} \ty{Sequence} in $y$ (Day of Week, \textit{etc})
			& $f : \ty{Number} \rightarrow \ty{Sequence}$ \\
		\hline
		%(fuzzify)
		\texttt{approximate}
			& Make a \ty{Duration} approximate
			& $f : \ty{Duration} \rightarrow \ty{Duration}$ \\
		\hline
	\end{tabular}
	\caption{
		The functional preterminals of the grammar.
		The name, a brief description, and the type signature of the function
			(as used in parsing) are given.
		Described in more detail in \refsec{repr-rules}, the functions generally 
			apply generic interval or sequence modifications.
		\todo{Functions should have clipart}
	}
	\label{tab:function}
	\end{center}
\end{table*}

% -- Intro
We define a set of preterminals, consisting of pairs of 
	\textit{types} and \textit{instances}	of temporal expressions.
A distinction is made between entities with content roles verus entities
	of functional role.

% -- Content
The first -- consisting of \ty{Range}s, \ty{Sequence}s, and \ty{Duration}s --
	are listed in \reftab{content}.
A total of 57 such preterminals are defined in the system described,
	although this list is easily modifiable to fit specialized domains.
It should be noted that, although the expressions are described in English,
	their meaning is purely semantic.
That is, there is no relation between the concept \te{Today} and the
	word \tp{today}.
Furthermore, entities which are subject to interpretation -- for example
	\te{Quarter} or \te{Season} -- are given a concrete interpretation.
The \th{$n$} quarter is defined by evenly splitting a year into four;
	the seasons are defined in the same way but with winter beginning in December.

% -- Functional
The functional entities are described in \reftab{function} and correspond to
	the \ty{Function} type.
The majority of these mirror generic operations on intervals on a timeline,
	or manipulations of a sequence.
Notably, like intervals times can be moved (\tp{3 weeks ago}) or
	their size changed (\tp{the first two days of the month}), or
	a new interval can be started from one of the endpoints
	(\tp{the last 2 days}).
Additionally, a sequence can be modified by shifting its origin
	(\tp{last Friday}), 
	or taking the \th{$n$} element of the sequence within some bound
	(\tp{fourth Sunday in November}).
Lastly, a rule is included to make a concrete \ty{Duration} approximate.

% -- Other
The lexical entries for the \ty{Nil} and \ty{Number} types are straightforward,
	though they play an important role in parsing, as described later.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RULES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Subsection{repr-rules}{Grammar}
% -- Intro
The synchronous PCFG grammar consists of a standard CFG rule over temporal
	types (in $\sV$) paired with a deterministic procedure for combining instances
	of those types (in $\sW$).
This deterministic procedure can be summarized as function application,
	though in particular it breaks down into three operations:

% -- Operators
\begin{itemize}
	%(function application)
	\item Applying (or partially applying) a function with one of its
			arguments.
		A separate rule exists for applying on the left versus on the right --
		that is, for composing $f(x,y) \odot x$ versus $x \odot f(x,y)$.
		\todo{reference a logic theory}\needcite
	%(intersection)
	\item Intersecting two ranges or sequences.
		This roughly equates to applying a special \textit{intersect} function
			without requiring that it be explicit in the temporal phrase.
		The intersect function treats both arguments as intervals, and will return
			the overlap between the intervals.

		In the case of sequences (e.g. \te{\th{13}} intersect \te{Friday}) a
			search is performed to find overlapping ranges in the two sequences;
			the \textit{zero index} is updated according to proximity to the
			reference time.
		In cases where this search cannot be solved analytically, and A$^{*}$
			search is used to find a solution in time logarithmic with respect to
			the distance to the next overlapping interval.
	%(noop)
	\item Combine a non-\ty{Nil} element with \ty{Nil} with no change to the
			temporal expression.
		This rule allows for words to not contribute to the final temporal
			expression;
			additionally, the lexicalization of the \ty{Nil} type allows the algorithm
			to take hints from these supporting words.
\end{itemize}

% -- Segue
We have defined a framework for representing and parsing temporal phrases
	based on a synchronous PCFG.
We proceed to describe learning the parameters of this grammar in a
	distantly-supervised setting.

